CLEAR COLUMNS
CLEAR BREAKS
CLEAR COMPUTES
TTITLE OFF 

ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY';
SET LINESIZE 80
SET PAGESIZE 30	

COLUMN FOOD_ID	  	 FORMAT  A7
COLUMN NAME	  	 HEADING FOOD_NAME
COLUMN TYPE	   	 FORMAT  A17
COLUMN TOTAL_REVENUE	 FORMAT  $9999.99

ACCEPT input_date PROMPT 'Enter month and year (MON-YYYY):'

TTITLE LEFT '----- most and least popular food items ordered monthly by customers-----' skip 2  CENTER 'Page: ' FORMAT 99 SQL.PNO SKIP 2

BREAK ON TYPE ON TOTAL_QTY SKIP 1
COMPUTE SUM LABEL 'TOTAL' OF TOTAL_QTY ON TYPE
COMPUTE SUM OF TOTAL_REVENUE ON TYPE

SELECT F.FOOD_ID,F.NAME,F.TYPE,COUNT(O.QUANTITY) AS TOTAL_QTY,SUM(F.PRICE * O.QUANTITY) AS TOTAL_REVENUE
FROM FOOD_ITEM F
JOIN ORDER_DETAILS O ON F.FOOD_ID = O.FOOD_Id
JOIN CUSTOMER C ON O.CUSTOMER_ID = C.CUSTOMER_ID
WHERE TO_CHAR (O.ORDER_DATE, 'MON-YYYY') = '&input_date' 
GROUP BY F.FOOD_ID,F.NAME,F.TYPE
HAVING COUNT(O.QUANTITY) = (
	SELECT MAX(QUANTITYCOUNT) 
	FROM (
		SELECT COUNT(OD.QUANTITY) AS QUANTITYCOUNT
		FROM FOOD_ITEM FI
		JOIN ORDER_DETAILS OD ON FI.FOOD_ID = OD.FOOD_Id
		WHERE TO_CHAR (OD.ORDER_DATE, 'MON-YYYY') ='&input_date' 
		GROUP BY FI.FOOD_ID
	)
)
OR COUNT(O.QUANTITY) = (
	SELECT MIN(QUANTITYCOUNT) 
	FROM (
		SELECT COUNT(OD.QUANTITY) AS QUANTITYCOUNT
		FROM FOOD_ITEM FI
		JOIN ORDER_DETAILS OD ON FI.FOOD_ID = OD.FOOD_Id
		WHERE TO_CHAR (OD.ORDER_DATE, 'MON-YYYY') ='&input_date' 
		GROUP BY FI.FOOD_ID
	)
)
ORDER BY TYPE ASC;
